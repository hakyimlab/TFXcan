<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Temi">

<title>TF binding analysis 2 | Model comparisons</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="impact-enformer-modelling-2_files/libs/clipboard/clipboard.min.js"></script>
<script src="impact-enformer-modelling-2_files/libs/quarto-html/quarto.js"></script>
<script src="impact-enformer-modelling-2_files/libs/quarto-html/popper.min.js"></script>
<script src="impact-enformer-modelling-2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="impact-enformer-modelling-2_files/libs/quarto-html/anchor.min.js"></script>
<link href="impact-enformer-modelling-2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="impact-enformer-modelling-2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="impact-enformer-modelling-2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="impact-enformer-modelling-2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="impact-enformer-modelling-2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">TF binding analysis 2 | Model comparisons</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Temi </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">fig.width=</span><span class="dv">12</span>, <span class="at">fig.height=</span><span class="dv">8</span>, <span class="at">cache=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">'/projects/covid-ct/imlab/users/temi/projects/TFXcan/scripts/'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(R.utils)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doMC)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>plots_dir <span class="ot">&lt;-</span> <span class="st">'../plots'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>models_dir <span class="ot">&lt;-</span> <span class="st">'../models'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>TF <span class="ot">&lt;-</span> <span class="st">'GATA3'</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>cistrome_dir <span class="ot">&lt;-</span> <span class="st">'/projects/covid-ct/imlab/data/cistrome/compressed'</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>hf_info <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">glue</span>(<span class="st">'{cistrome_dir}/human_factor_full_QC.txt'</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>TF_DCID <span class="ot">&lt;-</span> hf_info[hf_info<span class="sc">$</span>Factor <span class="sc">==</span> TF, ]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(TF_DCID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    DCid      Species     GSMID Factor Cell_line       Cell_type Tissue_type
1:  2324 Homo sapiens GSM720423  GATA3     MCF-7      Epithelium      Breast
2:  2325 Homo sapiens GSM720422  GATA3     MCF-7      Epithelium      Breast
3:  9195 Homo sapiens GSM957608  GATA3 RPMI-8402 T cell leukemia       Blood
4:  9196 Homo sapiens GSM957609  GATA3 RPMI-8402 T cell leukemia       Blood
5: 33129 Homo sapiens GSM986070  GATA3     MCF-7      Epithelium      Breast
6: 33136 Homo sapiens GSM986075  GATA3     MCF-7      Epithelium      Breast
   FastQC UniquelyMappedRatio   PBC PeaksFoldChangeAbove10       FRiP
1:     30              0.7981 0.980                   5420 0.03490225
2:     30              0.8010 0.989                  12454 0.08374850
3:     39              0.7523 0.244                   1432 0.08693400
4:     39              0.7604 0.808                   3459 0.04521850
5:     39              0.8001 0.990                   8318 0.04329025
6:     39              0.7460 0.971                    358 0.00357925
   PeaksUnionDHSRatio
1:          0.9750000
2:          0.9810000
3:          0.8848000
4:          0.9524000
5:          0.9618000
6:          0.8949343</code></pre>
</div>
</div>
<p>https://stats.stackexchange.com/questions/138569/why-is-lambda-within-one-standard-error-from-the-minimum-is-a-recommended-valu</p>
<div style="page-break-after: always;"></div>
<p>For plotting, I need to load in the enformer annotations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>enformer_annotations <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">'../info-files/enformer_tracks_annotated-resaved.txt'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>enformer_annotations <span class="ot">&lt;-</span> enformer_annotations[<span class="sc">!</span><span class="fu">is.na</span>(enformer_annotations<span class="sc">$</span>assay), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using an individual for now &gt;&gt; will do this across all 3 individuals later</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ind <span class="ot">&lt;-</span> <span class="st">'HG00479'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are 5 major categories</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>assays <span class="ot">&lt;-</span> enformer_annotations<span class="sc">$</span>assay <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>assays</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "DNase-seq"        "ATAC-seq"         "TF ChIP-seq"      "Histone ChIP-seq"
[5] "CAGE experiment" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>z_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(assays)){</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    z <span class="ot">&lt;-</span> <span class="fu">combn</span>(assays, i)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    z_list[[i]] <span class="ot">&lt;-</span> <span class="fu">t</span>(z) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>assays_dt <span class="ot">&lt;-</span> plyr<span class="sc">::</span><span class="fu">rbind.fill</span>(z_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="helper-functions" class="level3">
<h3 class="anchored" data-anchor-id="helper-functions">helper functions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>collate_coefficients <span class="ot">&lt;-</span> <span class="cf">function</span>(fit){</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    min_error_index <span class="ot">&lt;-</span> fit<span class="sc">$</span>index[<span class="st">'min'</span>, ]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    one_sd_index <span class="ot">&lt;-</span> fit<span class="sc">$</span>index[<span class="st">'1se'</span>, ]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    dimensions <span class="ot">&lt;-</span> fit<span class="sc">$</span>glmnet.fit<span class="sc">$</span>beta<span class="sc">@</span>Dim</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    coef_mat <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(fit<span class="sc">$</span>glmnet.fit<span class="sc">$</span>beta))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    temp_mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span><span class="cn">NA</span>, <span class="at">nrow=</span>dimensions[<span class="dv">1</span>], <span class="at">ncol=</span>dimensions[<span class="dv">2</span>])</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#print(dim(temp_mat))</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(coef_mat)){</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        temp_mat[coef_mat[i, <span class="st">'i'</span>], coef_mat[i, <span class="st">'j'</span>]] <span class="ot">&lt;-</span> coef_mat[i, <span class="st">'x'</span>]</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    temp_mat[<span class="fu">is.na</span>(temp_mat)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    fit_beta <span class="ot">&lt;-</span> <span class="fu">cbind</span>(temp_mat[, min_error_index], temp_mat[, one_sd_index])</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># what features were used?</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    feature_data <span class="ot">&lt;-</span> enformer_annotations[enformer_annotations<span class="sc">$</span>feature_names <span class="sc">%in%</span> (fit<span class="sc">$</span>glmnet.fit<span class="sc">$</span>beta <span class="sc">|&gt;</span> <span class="fu">rownames</span>()), <span class="fu">c</span>(<span class="st">'assay'</span>, <span class="st">'feature_names'</span>)]</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    fit_beta <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(fit_beta, feature_data))</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(fit_beta)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>test_models <span class="ot">&lt;-</span> <span class="cf">function</span>(model, X_test_set, y_test_set){</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    features <span class="ot">&lt;-</span> model<span class="sc">$</span>glmnet.fit<span class="sc">$</span>beta <span class="sc">|&gt;</span> <span class="fu">rownames</span>()</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    X_test_set <span class="ot">&lt;-</span> X_test_set[, features]</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assess.glmnet</span>(model, <span class="at">newx =</span> X_test_set, <span class="at">newy =</span> y_test_set) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-the-models" class="level2">
<h2 class="anchored" data-anchor-id="load-the-models">Load the models</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>aggModels_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'aggByCenter'</span>, <span class="st">'aggByMean'</span>, <span class="st">'aggByMeanUpstream'</span>, <span class="st">'aggByMeanDownstream'</span>, <span class="st">'aggByMeanUpstreamDownstream'</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>aggModels <span class="ot">&lt;-</span> <span class="fu">lapply</span>(aggModels_names, <span class="cf">function</span>(each_agg){</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">readRDS</span>(<span class="fu">glue</span>(<span class="st">'{models_dir}/enet_models_{each_agg}.RData'</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aggModels) <span class="ot">&lt;-</span> aggModels_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I need to curate predictions across the models (without a test set yet)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>cv_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(fit, <span class="at">lambda =</span> <span class="st">'lambda.1se'</span>){</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    whlm <span class="ot">&lt;-</span> <span class="fu">which</span>(fit<span class="sc">$</span>lambda <span class="sc">==</span> fit[[lambda]])</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mse</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    mse <span class="ot">&lt;-</span> fit<span class="sc">$</span>cvm[whlm]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">with</span>(fit<span class="sc">$</span>glmnet.fit,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>            tLL <span class="ot">&lt;-</span> nulldev <span class="sc">-</span> nulldev <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> dev.ratio)[whlm]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>            k <span class="ot">&lt;-</span> df[whlm]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            n <span class="ot">&lt;-</span> nobs</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">list</span>(<span class="st">'AICc'</span> <span class="ot">=</span> <span class="sc">-</span> tLL <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> k <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> k <span class="sc">*</span> (k <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> (n <span class="sc">-</span> k <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'BIC'</span> <span class="ot">=</span> <span class="fu">log</span>(n) <span class="sc">*</span> k <span class="sc">-</span> tLL)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    out<span class="sc">$</span>mse <span class="ot">&lt;-</span> mse</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">do.call</span>(cbind, out) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>())</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>aggModels<span class="sc">$</span>aggByCenter[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">cv_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       AICc      BIC       mse
1 -628.7396 709.6987 0.8497953</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>aggModels_metrics <span class="ot">&lt;-</span> <span class="fu">lapply</span>(aggModels, <span class="cf">function</span>(each_model_list){</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(each_model_list, cv_metrics))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aggModels_metrics) <span class="ot">&lt;-</span> aggModels_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="predict-on-the-test-set" class="level3">
<h3 class="anchored" data-anchor-id="predict-on-the-test-set">predict on the test set</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>aggModels_predict_test <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(aggModels), <span class="cf">function</span>(i){</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    test_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">glue</span>(<span class="st">'/projects/covid-ct/imlab/users/temi/projects/TFXcan/output/train-test-data/test_{names(aggModels[i])}_{ind}.csv'</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    X_test <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_data[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>)])</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    y_test <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_data[, <span class="dv">1</span>])</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(aggModels[[i]], test_models, X_test, y_test)) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select the models with the minimum mse</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>best_features <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(aggModels_predict_test), <span class="cf">function</span>(i){</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    whmin <span class="ot">&lt;-</span> <span class="fu">which.min</span>(aggModels_predict_test[[i]][, <span class="dv">4</span>])</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    feats <span class="ot">&lt;-</span> assays_dt[whmin, ]</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    feats <span class="ot">&lt;-</span> feats[<span class="sc">!</span><span class="fu">is.na</span>(feats)]</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(feats, <span class="at">collapse=</span><span class="st">' + '</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>best_models <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(aggModels_predict_test), <span class="cf">function</span>(i){</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    whmin <span class="ot">&lt;-</span> <span class="fu">which.min</span>(aggModels_predict_test[[i]][, <span class="dv">4</span>])</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    aggModels[[i]][[whmin]]</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(best_features) <span class="ot">&lt;-</span> aggModels_names</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(best_models) <span class="ot">&lt;-</span> aggModels_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>aggMethods <span class="ot">&lt;-</span> <span class="fu">do.call</span>(c, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(<span class="fu">seq_along</span>(best_features), <span class="cf">function</span>(mi){</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">glue</span>(<span class="st">'{names(best_features)[mi]}: {best_features[[mi]]}'</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>best_metrics <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_along</span>(aggModels_predict_test), <span class="cf">function</span>(i){</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    whmin <span class="ot">&lt;-</span> <span class="fu">which.min</span>(aggModels_predict_test[[i]][, <span class="dv">4</span>])</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    aggModels_predict_test[[i]][whmin, ]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>best_metrics <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, best_metrics) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>best_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">method=</span>aggMethods, best_metrics)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>best_metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                 method
31 aggByCenter: DNase-seq + ATAC-seq + TF ChIP-seq + Histone ChIP-seq + CAGE experiment
13                                            aggByMean: TF ChIP-seq + Histone ChIP-seq
30       aggByMeanUpstream: ATAC-seq + TF ChIP-seq + Histone ChIP-seq + CAGE experiment
10                                          aggByMeanDownstream: ATAC-seq + TF ChIP-seq
26   aggByMeanUpstreamDownstream: DNase-seq + ATAC-seq + TF ChIP-seq + Histone ChIP-seq
   deviance.lambda.1se class.lambda.1se      auc mse.lambda.1se mae.lambda.1se
31           0.8615837           0.1700 0.892356      0.2597969      0.5454180
13           0.8156511           0.1670 0.896096      0.2530849      0.5152429
30           0.6113700           0.1190 0.950053      0.1821517      0.4325133
10           0.6645528           0.1325 0.938558      0.1994726      0.4581010
26           0.6102948           0.1210 0.949892      0.1807648      0.4300246</code></pre>
</div>
</div>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df_beta_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(best_models, collate_coefficients)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>useColors <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n=</span><span class="dv">8</span>, <span class="at">name=</span><span class="st">'Dark2'</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>df_beta_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'For lambda with minimum mean cv error'</span>, <span class="st">'For largest lambda with 1 s.e within the mininum error'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># layout(matrix(c(1, 2, 3, 4, 5), nrow=5, ncol=1, byrow=T), height=c(6, 6, 6, 6, 6))</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># layout.show(5)</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(mi <span class="cf">in</span> <span class="fu">seq_along</span>(df_beta_list)){</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    bmodel_df_beta <span class="ot">&lt;-</span> df_beta_list[[mi]]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    bmodel_df_beta_split <span class="ot">&lt;-</span> <span class="fu">split</span>(bmodel_df_beta, bmodel_df_beta<span class="sc">$</span>assay)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># define the layout</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> T), <span class="at">height=</span><span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>), <span class="at">width=</span><span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">2</span>))</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">2.5</span>,<span class="dv">2</span>,<span class="dv">2</span>) <span class="sc">+</span> <span class="fl">0.1</span>, <span class="at">oma=</span><span class="fu">c</span>(<span class="fl">3.5</span>, <span class="fl">2.0</span>, <span class="fl">3.5</span>, <span class="fl">0.5</span>) <span class="sc">+</span> <span class="fl">0.1</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>){</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>        ylimits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(bmodel_df_beta[, i]), <span class="fu">max</span>(bmodel_df_beta[, i]))</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(ylimits)</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">plot</span>(<span class="at">x=</span>bmodel_df_beta_split[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">row.names</span>() <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(), <span class="at">y=</span>bmodel_df_beta_split[[<span class="dv">1</span>]][, i], <span class="at">type=</span><span class="st">'l'</span>, <span class="at">col=</span>useColors[<span class="dv">1</span>], <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(bmodel_df_beta)), <span class="at">ylim=</span>ylimits, <span class="at">xaxt=</span><span class="st">'n'</span>, <span class="at">main=</span>df_beta_labels[i])</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(bmodel_df_beta_split)){</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">lines</span>(<span class="at">x=</span>bmodel_df_beta_split[[j]] <span class="sc">|&gt;</span> <span class="fu">row.names</span>() <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(), <span class="at">y=</span>bmodel_df_beta_split[[j]][, i], <span class="at">col=</span>useColors[j])</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#mtext('TTTT', side=1, outer=T, cex=1.2)</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at=</span><span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(bmodel_df_beta)))</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="st">'tracks'</span>, <span class="at">side=</span><span class="dv">1</span>, <span class="at">outer=</span>T, <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">line=</span><span class="dv">2</span>, <span class="at">adj=</span><span class="fl">0.4</span>)</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="st">'coefficients'</span>, <span class="at">side=</span><span class="dv">2</span>, <span class="at">outer=</span>T, <span class="at">cex=</span><span class="fl">1.2</span>)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mtext</span>(<span class="fu">glue</span>(<span class="st">'{names(best_features)[mi]}: {best_features[[mi]]}'</span>), <span class="at">side=</span><span class="dv">3</span>, <span class="at">outer=</span>T, <span class="at">cex=</span><span class="fl">1.3</span>, <span class="at">adj=</span><span class="dv">0</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mai=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot.new</span>()</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">'right'</span>, <span class="at">legend=</span><span class="fu">names</span>(bmodel_df_beta_split), <span class="at">col=</span>useColors[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(bmodel_df_beta_split)], <span class="at">lty=</span><span class="dv">1</span>, <span class="at">bty=</span><span class="st">'n'</span>)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="impact-enformer-modelling-2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="1152"></p>
</div>
<div class="cell-output-display">
<p><img src="impact-enformer-modelling-2_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="1152"></p>
</div>
<div class="cell-output-display">
<p><img src="impact-enformer-modelling-2_files/figure-html/unnamed-chunk-20-3.png" class="img-fluid" width="1152"></p>
</div>
<div class="cell-output-display">
<p><img src="impact-enformer-modelling-2_files/figure-html/unnamed-chunk-20-4.png" class="img-fluid" width="1152"></p>
</div>
<div class="cell-output-display">
<p><img src="impact-enformer-modelling-2_files/figure-html/unnamed-chunk-20-5.png" class="img-fluid" width="1152"></p>
</div>
</div>
<p><span class="math inline">\(y_{i} \sim \sum_{i=1}^{m}\sum_{j=1}^{k}x_{ij}\beta_{ij} + \epsilon\)</span></p>
<p><span class="math inline">\(log(\frac{p_{i}}{(1-p_{i})}) = \beta_{0} + \sum_{i=1}^{m}\sum_{j=1}^{k}x_{ij}\beta_{ij}\)</span></p>
<p><span class="math inline">\(p_{i} = \frac{1}{1-e^{-x_{i}}} = \frac{1}{1-e^{-(\beta_{0} + \sum_{i=1}^{m}\sum_{j=1}^{k}x_{ij}\beta_{ij})}}\)</span></p>
<p>where <span class="math inline">\(m\)</span> is the number of predictors, in this case the number of tracks or thereabouts from ENFORMER, <span class="math inline">\(k\)</span> is the number of categories, in this case any of the following:</p>
<ol type="1">
<li>ATAC-seq</li>
<li>TF ChIP-seq</li>
<li>Histone ChIP-seq</li>
<li>CAGE experiments</li>
<li>DNase-seq,</li>
</ol>
<p><span class="math inline">\(y\)</span> is the presence or absence of TF-binding, in this case GATA3 binding, <span class="math inline">\(x_{ij}\)</span> is the predictor (from ENFORMER) of sample <span class="math inline">\(i\)</span> belonging to category <span class="math inline">\(j\)</span> and aggregated by any of the following:</p>
<ol type="1">
<li>mean of the 8 bins upstream and downstream the motif bin</li>
<li>just the motif bin</li>
<li>mean of all the bins</li>
<li>mean of only the upstream bins</li>
<li>mean of only the downstream bins.</li>
</ol>
<div class="cell">

</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>